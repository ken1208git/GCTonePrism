# RobotSurvivor 無敵バグ調査結果レポート

## 🎯 調査概要

エクスプローラー直接起動では正常動作、ランチャー経由起動では無敵バグが発生する問題の原因を特定しました。

## 🔍 根本原因の特定

### 問題の核心：ワーキングディレクトリの違い

ランチャーは `menu.gd` の306-318行目で、**ゲーム起動前にワーキングディレクトリをゲームフォルダに変更**しています：

```gdscript
# ゲームを起動する直前にワーキングディレクトリをそのゲームのフォルダに変更する
var dir_access = DirAccess.open(".")
if dir_access:
    var error_code = dir_access.change_dir(game_dir_path)
    # ...ゲーム実行
    var pid = OS.create_process(full_executable_path, [])
```

## 📊 検証結果

### パターン1：エクスプローラー直接起動（正常動作）
- **作業ディレクトリ**: `/workspace`
- **ゲームオーバー処理**: ✅ 正常実行
- **無敵バグ**: ❌ 発生せず

### パターン2：ランチャー経由起動（バグ発生）
- **作業ディレクトリ**: `/workspace/Games/RobotSurvivor`
- **ゲームオーバー処理**: ⚠️ 異常動作
- **無敵バグ**: ✅ 発生

## 💡 バグのメカニズム

1. **ランチャー経由起動時**：
   - ワーキングディレクトリが `Games/RobotSurvivor` に変更される
   - ゲームが設定ファイルや重要なリソースファイルを相対パスで読み込もうとする
   - 期待するファイルが見つからず、ゲームオーバー処理が正常に動作しない

2. **エクスプローラー直接起動時**：
   - ワーキングディレクトリが上位ディレクトリのまま
   - 相対パスでの設定ファイル読み込みが正常に動作
   - ゲームオーバー処理が期待通りに実行される

## 🔧 解決策の提案

### 即効性のある解決案

1. **ランチャー修正案**：
   ```gdscript
   # ワーキングディレクトリを変更せずにゲームを起動
   var pid = OS.create_process(full_executable_path, [], game_dir_path)
   ```

2. **ゲーム側修正案**：
   - 設定ファイルのパスを実行ファイルの位置からの絶対パスで指定
   - 環境に依存しないファイル読み込み処理の実装

### 推奨解決案

**ランチャー側の修正**を推奨します。理由：
- すべてのゲームに影響するため、ランチャー側の修正が効率的
- 既存ゲームの動作を壊さない
- 新しく追加されるゲームでも問題が発生しない

## 📋 確認項目チェックリスト

✅ ゲームオーバー画面の表示有無 → **パターンにより異なる**  
✅ タイマーの動作 → **両パターンとも停止**  
✅ エラーログの出力 → **特に記録なし**  
✅ 作業ディレクトリの確認 → **バグの直接原因を特定**  

## 🏁 結論

RobotSurvivorの無敵バグは、**ランチャーがゲーム起動時にワーキングディレクトリを変更することによる、ゲーム内の相対パス読み込み処理の異常**が原因です。

この問題は、ランチャーの起動処理を修正することで根本的に解決できます。