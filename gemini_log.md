# GCTonePrism 開発ログ with Gemini

**目的:** このドキュメントは、Geminiとの対話を通じて`GCTonePrism`を開発する過程を、**可能な限り詳細に記録する**ためのものです。コードの変更だけでなく、設計に関する議論、発生した問題とその解決策、そして最終的な意思決定に至るまでの思考プロセスをすべて保存し、将来の参照性を最大化することを目的とします。



## 2025-06-30

### 1. プロジェクトの引き継ぎと方針確認

- **発端:** ユーザーがWeb UI版のGeminiで進めていたプロジェクト`GCTonePrism`の引き継ぎを、CLI版のGeminiに依頼。Web UIではコンテキスト長の制限により、多くの情報を一度に扱えない問題があった。
- **命名規則に関する議論:**
	- **ユーザーの疑問:** 以前のWeb UIでの対話で「広く引用するファイルはファイル名を大文字にする」という助言を受けたが、直感に反する感覚がある、との質問。
	- **Geminiからの説明:** 一般的なGodot/GDScriptの慣習を提示。
		- `PascalCase` (大文字始まり): クラス名、シングルトン名 (例: `Global`, `PlayerController`)。これらは「設計図」や「概念」を表す。
		- `snake_case` (小文字始まり): ファイル名、変数名、関数名 (例: `player.gd`, `player_speed`, `_on_jump()`)。これらは「具体的な実体」や「データ」、「処理」を表す。
		- `SCREAMING_SNAKE_CASE`: 定数 (例: `MAX_SPEED`)。
	- **意思決定:** ユーザーはコミュニティの標準である公式ルールに則ることを決定。既存コードがこのルールに準拠しているか確認し、もし逸脱していれば修正する方針で合意。
- **既存コードの確認:**
	- `Global.gd`, `debug_monitor.gd`, `menu.gd` などの主要スクリプトを調査した結果、**すべてのコードが既に標準的な命名規則に準拠している**ことが判明。リファクタリングは不要と結論。

### 2. ファイルI/O問題の特定と解決

- **事象の発生:** `README.md`の改善版を `write_file` や `replace` ツールで書き込もうとしたところ、複数回にわたり `EBADF: bad file descriptor` や `ENOENT: no such file or directory` といったエラーで失敗。
- **原因の切り分け:**
	- **テスト:** 問題の切り分けのため、`test_write.txt`の新規作成を試みるも、同様に`ENOENT`エラーで失敗。これにより、`README.md`固有の問題ではなく、ファイル書き込み全般の問題であると特定。
	- **ユーザーからの情報提供:** ユーザーが`ENOENT`エラーについてWebで検索し、Linux環境での32/64bitアーキテクチャ不一致の可能性を提示。
	- **Geminiによる分析:** 提示された記事の内容を分析。現在のWindows環境でのテキストファイル書き込みという状況とは異なるため、アーキテクチャ不一致の可能性は低いと判断。
	- **根本原因の推定:** 最も可能性の高い原因として、Windowsのセキュリティ機能**「コントロールされたフォルダーアクセス」**が、Gemini CLIによるドキュメントフォルダへの書き込みをブロックしている、あるいはOneDriveの同期プロセスがファイルロックをかけている可能性を提示。
- **解決:** ユーザーが自身のPCで**「コントロールされたフォルダーアクセス」をオフ**にしたところ、`README.md`の書き込みに成功。問題の根本原因が同機能であったことが確定した。

### 3. `README.md`の改善

- **ユーザーの要望:** Markdownの記法（フォントサイズ変更など）が分からないため、`README.md`を自動で見やすくしてほしい、との依頼。
- **Geminiの提案と実行:**
	- Markdownでは直接のフォントサイズ変更はせず、見出し・リスト・コードブロック等の構造化で見やすくすることを説明。
	- 構成の明確化、コードブロックの適用、絵文字の活用、開発者向け「Getting Started」セクションの追加などを含む改善版を提案。
	- ファイル書き込み問題の解決後、改善版の内容で`README.md`を正常に上書き更新した。

### 4. データ構造の設計：「ハイブリッド案」の採択

- **発端:** `game_info.json`のサンプル作成を提案したところ、ユーザーから設計に関する鋭い質問。
- **論点1：キーマッピングの方式**
	- **ユーザーの構想:** ゲームごとにマッパーexeを用意するのではなく、単一の管轄exeが、JSONからキーマップデータを読み取って振る舞う方式は可能か？
	- **Geminiの評価:** 技術的に可能であり、より高度で理想的な設計であると評価。
- **論点2：JSONファイルの配置**
	- **ユーザーの疑問:** 全ゲーム情報を単一ファイルで管理するより、各ゲームフォルダに分散させた方が楽ではないか？ ただし、表示順の管理が問題となる点を懸念。
- **Geminiからのハイブリッド提案:** 両者のメリットを両立する案を提示。
	- **`launcher_config.json` (ルートに配置):**
		- ゲームの表示順序を配列 `games_order` で集中管理。
		- キーマッパー管轄exeのパス `key_mapper_executable` もここで管理。
	- **`game.json` (各ゲームフォルダ内に配置):**
		- 各ゲーム固有の情報（タイトル、説明、画像パスなど）を管理。
		- ユーザー構想のキーマップデータ `key_mapping` もここに含める。
- **意思決定:** この**ハイブリッド案**が、順序管理の容易さと、各ゲーム情報の独立性を両立できる最も優れた方式であるとして、採用を決定。

### 5. 次のステップ

- この開発ログ `gemini_log.md` を作成・保存する。
- 採択されたハイブリッド案に基づき、`launcher_config.json`をプロジェクトルートに作成する。
- ダミーのゲームフォルダと、その中に配置する`game.json`を作成する。

### 6. 環境設定問題：APIキーの認証

- **事象の発生:** 会話モデルがFlashに切り替わり、APIキーの入力を求められる事象が発生。これにより、Gemini CLIとの対話が一時的に中断。
- **原因の特定と解決:**
	- **ユーザーからの情報:** ユーザーがAPIキーを既に所有していることを確認。
	- **Geminiからの説明:** CLIでのAPIキー入力方法（対話形式、環境変数、設定ファイル）について説明。
	- **PowerShellでの永続設定:** ユーザーがPowerShellを使用していることから、`[System.Environment]::SetEnvironmentVariable("YOUR_API_KEY_NAME", "YOUR_ACTUAL_API_KEY_HERE", "User")` コマンドによる環境変数の永続設定方法を提示。
	- **設定の実行と確認:** ユーザーがコマンドを実行し、エラーなく完了したことを確認。PowerShellの再起動により、APIキーが正常に認識され、Gemini CLIが再び動作可能になった。
- **意思決定:** この環境設定に関する問題と解決策は、将来の参照のために開発ログに記録することが重要であると判断し、追記を決定。

### 7. 開発環境と正式名称の決定

- **開発環境の方針決定:**
	- **課題:** 学校のPCは再起動するとローカルデータが消去されるという特殊な環境。
	- **解決策:** 外部サーバー（実態はネットワーク共有フォルダ）をプライマリな作業場所として利用する方針を固めた。
	- **具体的な運用:** サーバー上にGodotプロジェクトを配置。GitHub Desktop, VS Code, Gemini CLIといった開発ツールは、すべて「ポータブル版」をサーバー上の特定フォルダに置き、そこから直接起動して作業を行う。これにより、学校PCの環境に依存せず、どこからでも同じ環境で開発を継続できる体制を確立した。

- **プロジェクトの正式名称決定:**
	- **議論:** 元の名称「ゲームセンターTONE ランチャーシステム Prism」に、プロジェクトの多機能性を反映させるための議論を実施。
	- **意思決定:** 複数の候補の中から、機能性を的確に表す「**ゲームセンターTONE 統合ランチャーシステム Prism**」を正式名称として採択。
	- **反映:** 決定に基づき、ユーザーが`README.md`のタイトルを即時更新した。

### 8. `GEMINI.md`の改訂：AIの振る舞いに関するルール強化

- **発端:** 開発を進める中で、AI（Gemini）のプロジェクト理解度とコード解説の一貫性をさらに向上させる必要性が浮上。
- **議論と意思決定:** ユーザーからの提案に基づき、AIの振る舞いを規定する`GEMINI.md`の内容を、より具体的かつ強制力のあるルールに改訂することに合意。
- **改訂内容:**
	1.  **起動シーケンスの厳格化:**
		- **ルール:** セッション開始時、`README.md`と`gemini_log.md`の読み込み後、**必ずプロジェクト全体のファイル構造を網羅的に把握する**ことを義務付けた。
		- **目的:** プロジェクトの物理的な全体像を初期段階で完全に理解し、より精度の高い応答を生成するため。
	2.  **コード解説ルールの強化:**
		- **ターゲットの明確化:** コードブロック内のコメント（`#`）は、**「プログラミング経験の浅い新入部員」**が読むことを想定し、コードの「意図」を説明するものと定義。
		- **解説形式の絶対化:** コードブロック外の解説では、ユーザー個人に向けた平易な動作説明、バグ修正の詳細な経緯、そして**キーワード分類（[Godotの機能], [あなたが付けた名前], [定義済みのものを再利用]）を必須項目**として徹底することを決定。
- **反映:** 上記の決定に基づき、`GEMINI.md`を即時更新した。これにより、今後の開発におけるAIとの連携プロセスが標準化され、一貫性と正確性が担保されることになった。

### 9. ファイル破損問題の特定と修復

- **事象の発生:** `gemini_log.md`にセクション8を追記した後、ユーザーからファイル内容の不整合と文字化けの指摘を受ける。
- **原因の特定:**
	- **初期分析:** 当初は改行コード（CRLF/LF）の違いによる表示上の問題と推定。
	- **根本原因の判明:** ユーザーからのさらなる指摘により、**ファイル書き込み時の文字コード（エンコーディング）の取り扱いミスによるデータ破損（文字化け）**が根本原因であると特定。AI側のツールが日本語の文字を破壊していた。
- **修復プロセス:**
	- **方針:** ユーザーの提案に基づき、破損した現在のファイルを正として、AIが文脈を読み取りながら手動で修正する方針を採択。
	- **実行:** `gemini_log.md`および、同様に破損していた`GEMINI.md`の内容を精査し、文字化け箇所を修正したバージョンをユーザーが確認。
	- **完了:** ユーザーの承認を得て、修正済みの内容で両ファイルを上書きし、完全に復旧させた。
- **再発防止策:**
	- **意思決定:** 今後のファイル書き込み、特にログ記録において文字化けを再発させないよう、`GEMINI.md`に**「ファイル書き込み時にUTF-8エンコーディングを維持し、文字化けを絶対に起こさないこと」**という厳格なルールを追記。これにより、AIのファイル操作における品質基準を明確化した。

### 10. GitHub CLIの導入とPATHの問題

- **発端:** ユーザーがGitHubのIssuesをCLI上で直接読み込みたいと要望。
- **経緯:**
	- 解決策として、公式の`gh`コマンド（GitHub CLI）を提案。
	- `gh --version`でインストールの有無を確認したところ、未導入であることが判明。
	- `winget install --id GitHub.cli`コマンドを実行し、インストールを実施。
	- 再度`gh --version`を実行するも、コマンドが認識されないエラーが発生。
- **課題と次のステップ:**
	- インストール直後で、現在のターミナルセッションに実行パス（PATH）が反映されていないことが原因と断定。
	- **解決策として、ユーザーが一度Gemini CLIを再起動する必要がある。**
	- **引き継ぎ事項:** 再起動後、まず`gh --version`を実行してインストールを最終確認し、成功すれば次のステップである`gh auth login`によるGitHubアカウント認証に進む。

## 2025-07-01

### 11. GitHub CLI認証とIssue/マイルストーンの確認

- **発端:** `gemini_log.md`の引き継ぎ事項に基づき、GitHub CLIのセットアップを再開。
- **GitHub CLIの認証:**
	- `gh --version`でコマンドの認識を確認後、`gh auth login`による認証を試みる。
	- CLI環境では対話形式の認証が困難なため、ユーザーに直接ターミナルで`gh auth login`を実行してもらい、ブラウザでの認証を完了してもらうよう依頼。
	- 複数回の試行と確認を経て、`gh auth status`で`Logged in to github.com account ken1208git`と表示され、認証が成功したことを確認。
- **Issueリストの確認:**
	- ユーザーからの情報提供（`gh issue list --json number,title,state,labels`）を受け、プロジェクトの全IssueをJSON形式で取得し、一覧表示に成功。
- **マイルストーンの確認:**
	- `gh milestone list`コマンドを試みるも、Geminiの環境（gh CLI v2.74.2）では`milestone`サブコマンドが存在しないことが判明。
	- `gh project list`コマンドも試みるが、`--repo`フラグの誤用や、`read:project`スコープの権限不足により失敗。
	- 最終的に、現在のGemini環境では`gh milestone`コマンドが利用できないことをユーザーに伝え、手動でのマイルストーン管理を提案。

### 12. `README.md`の更新（Issueリスト反映）

- **ユーザーの要望:** `README.md`に記載されていないIssueを追記するよう依頼。
- **Geminiの対応:** Issueリストと既存の`README.md`を比較し、未記載の機能（ユーザー名管理、リアルタイムランキング、コントローラー操作、音量コントロール、スコアボード、ログ送信、デモ画面、リモート監視、ニュースフィード、評価機能、バージョン管理）を特定。
- **`README.md`の改訂:** 「実装予定の機能」セクションを「コア機能」「UI/UXの強化」「高度な連携・管理機能」「来場者エンゲージメント機能」に分類し、特定した未記載機能を追記。よりシステマチックな構成に更新。

### 13. Git操作と一時ファイルの管理

- **コミットの実行:**
	- `git status`で変更されたファイル（`GEMINI.md`, `README.md`, `gemini_log.md`）を確認。
	- `git add`で変更をステージング。
	- `git commit -m`でコミットを試みるが、シェルでの引用符の解釈問題によりエラーが発生。
	- コミットメッセージを一時ファイルに書き込み（`commit_message.txt`）、`git commit -F`でコミットを実行し成功。
- **プッシュの実行:**
	- `git push`コマンドでリモートリポジトリにプッシュし、変更を反映。
- **一時ファイルの削除:**
	- コミットメッセージ用の一時ファイル`commit_message.txt`が残っていることをユーザーから指摘。
	- Windows環境での`rm`コマンドの失敗後、`del`コマンドで正常に削除。

### 14. コミットメッセージの言語に関する議論

- **ユーザーの質問:** コミットメッセージは英語で書くべきか。
- **Geminiの回答:** 国際的な協力、ツールの互換性、一貫性と検索性の観点から、英語でのコミットメッセージが強く推奨されることを説明。良いコミットメッセージの書き方についても補足。

### 15. マイルストーンの再分類とv0.0の提案

- **ユーザーの要望:** Issueのマイルストーン分類表の再作成を依頼。
- **Geminiの対応:** 全Issueを「v0.1: コア機能」「v0.2: UI/UX向上」「v0.3: 高度な機能と安定性」「v0.4: 来場者エンゲージメント」「v1.0: 正式リリース」の5つのマイルストーンに再分類して提案。
- **v0.0マイルストーンの提案:** ユーザーから「開発環境構築などを暫定的にv0.0のマイルストーンに格納するのはありか」と質問を受け、非常に良いアイデアであると賛同。`#18`と`#15`をv0.0に含めることを提案し、そのテンプレートを作成。

### 16. `GEMINI.md`の更新（Issues自動閲覧の追加）

- **ユーザーの要望:** チャットボット起動時に自動でIssuesを閲覧するように`GEMINI.md`に記述するよう依頼。
- **Geminiの対応:** `GEMINI.md`の「必須起動シーケンス」に「開発タスクの確認（GitHub Issuesの読み込み）」ステップを追加。

## 2025-07-09

### 1. Issue #17「バージョン管理システムを作る」の実装とCase Mismatch問題の解決 (v0.1.0-dev.1)

- **目的:** ランチャーのバージョンを管理し、画面上に表示する仕組みを構築する。
- **議論:**
	- バージョン番号の付け方について議論。`0.1.0-dev.1`のような形式で、意味のある実装の区切りごとにdevナンバーを上げる方針を決定。
	- 「機能実装のコミット」と「バージョン番号自体の更新」は分離し、完了した作業のバージョンをコミットに含めるルールで合意。
- **実装内容:**
	1.  `Global.gd`にアプリケーションのバージョンを保持する定数`APP_VERSION`を`"0.1.0-dev.1"`として定義。
	2.  `debug_monitor.tscn`にバージョン表示用の`Label`ノードを追加。
	3.  `debug_monitor.gd`を修正し、起動時に`Global.APP_VERSION`の値を読み込んでラベルに表示する処理を追加。
- **問題発生と解決:**
	- **事象:** Godotから`Case mismatch opening requested file 'Global.gd', stored as 'global.gd'`という警告が多数発生。
	- **原因:** Autoloadに登録したシングルトン名`Global`と、実際のファイル名`global.gd`の大文字・小文字が一致していなかったため。
	- **解決策:** `global.gd`を`Global.gd`にリネームし、警告を解消。
- **結果:** Issue #17の基本実装が完了し、v0.1.0-dev.1のタスクが完了した。

### 2. Issue #11「デバッグモード機能を完成させる」の微調整 (v0.1.0-dev.2)

- **目的:** デバッグモニターがコンソールに出力していた不要なログメッセージを削除し、出力をクリーンにする。
- **実装内容:**
	- `scripts/debug_monitor.gd`の`_process`関数から、`print("デバッグモニター更新中。ログの行数:", Global.log_history.size())`の行を削除。
- **結果:** デバッグモニターの動作に影響なく、コンソール出力が整理された。

### 3. デバッグモニターのログ表示に関する問題 (v0.1.0-dev.3)

- **発端:** ユーザーからデバッグモニターのログ表示について、以下の2点の要望があった。
	1.  ログ表示を下から上に積層するようにしたい。
	2.  テキストがラベルの下側から出てくるようにしたい。
- **実装と問題発生の経緯:**
	- **ログ積層方向の変更:**
		- 最初の試みで `Array.reversed()` を使用したが、GDScriptには存在しないため `Invalid call. Nonexistent function 'reversed' in base 'Array'.` エラーが発生。
		- `duplicate()` と `reverse()` を組み合わせることで修正を試みた。
		- この際、改行コードを誤って `"/n"` と記述してしまい、これも修正した。
	- **テキスト垂直方向の配置変更:**
		- `RichTextLabel` の `vertical_alignment` プロパティを `VERTICAL_ALIGNMENT_BOTTOM` に設定しようとした。
		- `VERTICAL_ALIGNMENT_BOTTOM` が直接認識されず `Invalid set index 'vertical_alignment' (on base: 'RichTextLabel') with value of type 'int'.` エラーが発生。
		- `TextServer.VERTICAL_ALIGNMENT_BOTTOM` を試したが `Parser Error: Cannot find member "VERTICAL_ALIGNMENT_BOTTOM" in base "TextServer".` エラーが発生。
		- `Control.VERTICAL_ALIGNMENT_BOTTOM` を試したが `Parser Error: Cannot find member "VERTICAL_ALIGNMENT_BOTTOM" in base "Control".` エラーが発生。
		- `RichTextLabel.VERTICAL_ALIGNMENT_BOTTOM` を試したが、ユーザーがツール実行をキャンセルした。しかし、この形式が正しい可能性が高いと判断。
- **現在の状況:** 上記の修正を試みたにも関わらず、ユーザーからは「まだうまくできていない」との報告があり、問題が解決していない。引き続き原因の調査と修正が必要。

##2025-07-11

### 1. デバッグモニターのログ表示問題に関する試行錯誤 (v0.1.0-dev.4)

- **発端:** ユーザーから、デバッグモニターのログ表示を「Minecraftのチャット欄のように、新しいログが一番下に表示され、古いものが上にせり上がっていく」形式にしたい、との継続的な要望があった。
- **実装と試行錯誤の経緯:**この問題は非常に根深く、解決までに複数の段階的なアプローチを試みた。
	1.  レイアウト設定の試み: RichTextLabelのレイアウトプリセットをBottom WideやBottom Leftに設定する方法。
	2.  コンテナの利用: VBoxContainerと、目に見えない「スペーサー」(Controlノード)を組み合わせて、ログをコンテナの下部に押し付ける方法。
	3.  スクリプトからの制御: scroll_followingプロパティの有効化や、最終手段として、表示するデータそのものの順番をreverse()で逆転させる方法。
- **結果と意思決定:**上記の全ての解決策を試みたが、依然としてログは画面上部に表示される問題は解決には至らなかった。レイアウト設定とスクリプトの相互作用に、まだ見落としている根本的な原因がある可能性が高いと判断。しかし、これまでの試行錯誤の過程を記録として残すため、この未解決の状態のまま、v0.1.0-dev.4として一旦コミットを実行した。

- **今後の対応:** この根深いログ表示問題の完全な解決は、一度ペンディング（保留）とする。このタスク（Issue）はオープンのまま、将来のバージョン（v0.1.0-dev.5以降）の課題として、改めて根本的な原因の調査から取り組むこととする。

## 2025-08-05

### 1. Issue #1 の実装とデバッグモニターのバグ修正 (v0.1.0-dev.5)

- **目的:** データ駆動設計の基礎を築くため、外部設定ファイル(`JSON`)を読み込む機能を実装する。また、実装過程で発覚した既存のバグを修正する。

- **`launcher_info.json` のデータ構造設計:**
	- ユーザーとの詳細な対話を通じて、ゲーム情報を管理する`launcher_info.json`の仕様を策定。
	- ファイル名の衝突回避、将来の機能拡張性（複数人開発者、期生情報、コントローラー対応など）、データ型（数値 vs 文字列）の最適化など、多角的な検討を経て、堅牢なデータ構造を最終決定した。

- **実装内容:**
	1.  **JSONファイル作成:** 最終仕様に基づき、`launcher_config.json`と`launcher_info.json`を作成。
	2.  **設定読み込み機能:** `Global.gd`に`load_launcher_config()`関数を新設。Godot起動時に`launcher_config.json`を読み込み、内容をパースしてグローバル変数に保持する機能を実装した。
	3.  **バグ修正:**
		- **原因:** プロジェクト実行時に`debug_monitor.gd`で`Node not found`エラーが発生しクラッシュ。原因は、シーンツリー構造の変更にスクリプト側のノードパス指定が追従していなかったため。
		- **解決:** シーンツリーの現状に合わせて、`debug_monitor.gd`内の`log_label`へのパスを`$LogPanel/LogLabel`から`$LogLabel`に修正し、クラッシュを解決した。
		- **その他:** `global.gd`の`_unhandled_input`関数の未使用引数`event`を`_event`にリネームし、Godotのコーディング規約に準拠させた。

- **結果:**
	- ランチャー起動時に`launcher_config.json`が正常に読み込まれることを確認。
	- デバッグモニターのクラッシュバグが完全に解消された。
	- これにより、Issue #1の最初のステップが完了した。

### 2. Issue #1 ゲーム情報スキャン機能の実装 (v0.1.0-dev.6)

- **目的:** Issue #1の残りのタスクを完了させるため、各ゲームフォルダをスキャンして、`launcher_info.json`を読み込む機能を実装する。
- **実装内容:**
	- `Global.gd`に`load_all_games_info()`関数を新設。`launcher_config.json`の指示に従い、各ゲームフォルダをスキャンして、すべての`launcher_info.json`を読み込み、`Global.all_games_data`配列に格納する機能を実装した。
	- ユーザー提案に基づき、デバッグログを改善。スキャン時にゲームのタイトル、ID、実行ファイル名を出力するようにし、デバッグの効率を向上させた。
- **結果:**
	- ランチャー起動時に、すべてのゲーム情報が正常に読み込まれることを確認。
	- これにより、Issue #1のすべての要件が完了した。

### 3. Issue #3 UI骨格設計とデータ構造の最終化 (v0.1.0-dev.7)

- **目的:** Issue #3に着手し、HTMLモックアップを元にしたPS5風UIの基本的な骨格をGodot上で構築する。また、その過程で`launcher_info.json`の仕様を最終的に確定させる。

- **`launcher_info.json` 仕様の最終化:**
	- UI設計の議論の中で、さらなる改善点が発覚。
	- **難易度と所要時間:** ゲーム選択の補助情報として、`difficulty`（難易度）と`play_time`（所要時間）を3段階の数値で管理する仕様を追加。
	- **プレイ人数の範囲指定:** 「1〜4人」のような範囲指定に対応するため、`players`を`min_players`と`max_players`の2つの数値項目に分割。これにより、あらゆるプレイスタイルに柔軟に対応できるデータ構造が完成した。

- **UI実装内容:**
	- **UI部品の作成:** ゲームサムネイルの基礎となる`game_thumbnail.tscn`を、PS5のUIを参考に正方形(256x256)で作成。
	- **フォルダ構造の整理:** `scenes`フォルダ内を`main`, `components`, `system`, `tools`に再編成し、メンテナンス性を向上。
	- **解像度スケーリング設定:** プロジェクト設定のストレッチモードを`canvas_items`、アスペクトを`expand`に設定。これにより、ウルトラワイドモニターなど、様々なアスペクト比の画面に黒帯なしで対応する、真のレスポンシブUIの基礎を築いた。
	- **三分割レイアウトの構築:** ユーザーの構想に基づき、`HBoxContainer`と`VBoxContainer`をネストさせ、サイズフラグ（`Custom Minimum Size`と`Stretch Ratio`）を駆使することで、「左（カルーセル）、右上（空白）、右下（詳細）」の複雑な三分割レスポンシブレイアウトの骨格を完成させた。

- **結果:**
	- Issue #3のUI実装に向けた、再利用可能で、かつ柔軟なシーン構造が完成した。
	- `launcher_info.json`のデータ構造が、将来の拡張にも耐えうる堅牢なものとして確定した。

### 4. ドキュメントの改善 (v0.1.0-dev.7)

- **目的:** `README.md`を、プロジェクトの現状に合わせて全面的に改訂し、新入部員やゲーム制作者にとって、より分かりやすい公式ドキュメントを作成する。
- **主な変更点:**
	- **構成の再設計:** 読者の目的（ゲームを追加したい人 vs 開発したい人）に応じて、情報にたどり着きやすいように、全体の構成を全面的に見直した。
	- **ゲーム追加手順の明確化:** ゲーム制作者が迷わないように、フォルダやファイルの命名規則、ビルド後の動作確認の手順などを、より具体的で、間違いの起きないフローに修正した。
	- **用語の統一と表現の改善:** 「アイコン」を「サムネイル」に統一するなど、プロジェクト全体での用語の一貫性を確保し、初心者にも理解しやすい表現に全面的に書き換えた。
- **結果:**
	- プロジェクトの「顔」である`README.md`が、誰にとっても分かりやすく、かつ、プロジェクトの現状を正確に反映した、高品質なドキュメントに生まれ変わった。

## 2025-08-06

### 1. Issue #3 UIデザインの実装 (v0.1.0-dev.8)

- **目的:** Issue #3に基づき、`menu.tscn`の骨格に、HTMLモックアップを参考にした具体的なデザインを適用していく。
- **実装内容:**
	- **背景オーバーレイ:**
		- ユーザーの「カルーセルはグラデーション、詳細部分は半透明パネル」という優れたアイデアを採用。
		- 左側のリストエリア (`ListOverlay`) には、`GradientTexture1D`を使って、左から右へ消える黒のグラデーションを実装。
		- 右下の詳細情報エリア (`GameDetailsContainer`) には、`Panel`ノードと`StyleBoxFlat`を使い、角の丸い、美しい半透明の背景を実装した。
	- **情報レイアウトの設計:**
		- ユーザーの構想に基づき、詳細情報エリアのレイアウトを「タイトル」「メタ情報」「情報パネル」「説明文」「操作方法」「プレイボタン」の順で構成。
		- `InfoPanel`には、「プレイ人数」「難易度」「コントローラー対応」「教室内マルチプレイ」といった、アイコン付きの情報をグループ化して表示する、拡張性の高い構造を設計した。
	- **フォントとタイポグラフィ:**
		- 「美しさ」の源ノ角ゴシックと、「読みやすさ」のBIZ UDPゴシックを、役割に応じて使い分けるハイブリッド戦略を決定。
		- `TitleLabel`や`MetaLabel`に、テーマの上書きでフォントとフォントサイズを設定し、情報の階層化を行った。
	- **多機能説明パネルの設計:**
		- ユーザーのアイデアに基づき、「ゲーム説明」と「操作方法」を一つの`ScrollContainer`に統合。
		- 操作方法は、キーボードとコントローラーを左右に並べた`GridContainer`で表示する、非常に分かりやすいレイアウト構造を設計した。
- **結果:**
	- `menu.tscn`の静的なデザインが、ほぼ完成形に近づいた。
	- 次のステップは、このデザインされたUIに、スクリプトから動的にデータを流し込み、インタラクティブな機能（リスト選択、ボタン押下など）を実装することである。

## 2025-08-07

### 1. 開発環境の統一と、過去の警告の完全修正 (v0.1.0-dev.8)

- **目的:** 複数の開発環境（家、学校）で発生していた、意図しないコードの差分（インデントスタイルの違い）や、プロジェクト起動時に表示されていた長年の警告を完全に解消し、開発の土台をクリーンな状態にする。
- **実装内容:**
    - **`Case Mismatch`警告の解決:**
        - **原因:** Godotのシングルトン名`Global`と、ファイル名`global.gd`の大文字・小文字が一致していなかったことが原因で、起動時に大量の警告が発生していた。
        - **解決:** Godotの公式な命名規則に従い、ファイル名を`Global.gd`にリネーム。Gitのキャッシュが原因で発生したファイル名の重複問題を、コマンドライン(`git rm --cached`)を使って修正し、問題を完全に解決した。
    - **`Narrowing Conversion`警告の解決:**
        - **原因:** `debug_monitor.gd`内で、`float`（小数点数）を返す関数（`Performance.get_monitor`）の結果を、`int`（整数）型の変数に、型変換を明記せずに入れていた。
        - **解決:** `int()`で明示的に型変換を行うことで、意図した変換であることをコードで示し、警告を解消した。
    - **インデントスタイルの統一:**
        - Godotの公式スタイルガイドに基づき、プロジェクトの公式なインデントスタイルを**「タブ」**に決定。
        - **VS Codeワークスペース設定の導入:** プロジェクトフォルダ内に`.vscode/settings.json`を新設し、このプロジェクトを開いた際に、VS Codeのインデント設定が自動的に「タブ」になるように設定した (`"editor.insertSpaces": false`)。
- **結果:**
    - プロジェクト起動時の警告が、すべて解消された。
    - どの環境で開発しても、インデントスタイルが常に「タブ」に統一されるようになり、不要な差分の発生を完全に防ぐことができるようになった。

### 2. Issue #3 ゲームリストの動的生成を実装 (v0.1.0-dev.9)

- **目的:** `Global.all_games_data`の情報を元に、`menu.tscn`の左側リストに、ゲームのサムネイルを動的に生成・表示する機能を実装する。
- **実装内容:**
    - **`game_thumbnail.gd`の作成:**
        - サムネイル部品シーン(`game_thumbnail.tscn`)に、専用のスクリプトをアタッチ。
        - 外部から`game_data`を受け取り、サムネイル画像を設定するための`set_game_data`関数を設計した。
    - **`menu.gd`での動的生成:**
        - `_ready`関数から呼び出される`populate_game_list`関数を実装。
        - ループ処理の中で`game_thumbnail.tscn`をインスタンス化し、`set_game_data`関数を呼び出して、各ゲームのサムネイル画像を設定。
        - 生成したサムネイルを、`GameList` (`VBoxContainer`) に`add_child`で追加するロジックを完成させた。
- **デバッグと問題解決:**
    - **`Case Mismatch`警告の解決:** `Global.gd`のファイル名をリネームし、Gitのキャッシュ問題をコマンドラインで修正することで、プロジェクト起動時の長年の警告を完全に解消した。
    - **`Nil`エラーとの戦い:**
        - パス解決、`@onready`のライフサイクル、ノード名の一致など、複数の仮説を検証。
        - 最終的に、`instantiate()`されたノードの準備タイミングの問題であることを突き止め、`_ready()`に頼らず、`set_game_data`関数内でノードを取得する方法で、エラーを完全に解決した。
    - **外部リソース読み込み問題の解決:**
        - Godotの`load()`がプロジェクト外部の「未インポート」リソースを扱えない問題を特定。
        - `Image.load()`と`ImageTexture.create_from_image()`を使うことで、プロジェクト外部の生の画像ファイルを、安全かつ確実に読み込む、最終的な解決策を実装した。
- **結果:**
    - ランチャー起動時に、`launcher_info.json`に記述されたすべてのゲームのサムネイル画像が、左側のリストに、動的に、そして正しく表示されるようになった。
    - これにより、Issue #3の、最初の大きなマイルストーンが達成された。

### 3. Issue #3 UIの動的化と、ゲーム起動機能の実装 (v0.1.0-dev.9)

- **目的:** `menu.tscn`の静的なUIに、スクリプトから命を吹き込み、リスト選択、詳細表示、そしてゲーム起動という、ランチャーの核心的な機能を、完全に実装する。
- **実装内容:**
    - **リスト選択機能:**
        - `_unhandled_input`関数を使い、キーボードの上下入力で、選択項目（`current_selection_index`）を更新するロジックを実装。
        - 選択されたサムネイルの見た目が変わる（`scale`が大きくなる）`update_display`関数を実装し、ユーザーに視覚的なフィードバックを提供する仕組みを完成させた。
    - **詳細情報のリアルタイム更新:**
        - `update_display`関数を拡張し、選択項目が変わるたびに、`Global.all_games_data`から対応するゲームのデータを取得。
        - `title`, `developers`, `play_time`など、詳細情報エリアのすべての`Label`や`TextureProgressBar`の表示を、リアルタイムで更新するロジックを、完璧に実装した。
        - JSONの各項目が未入力の場合でも、UIが壊れないように、多数のフォールバック処理（`title`が空ならフォルダ名を表示するなど）を組み込んだ。
    - **ゲーム起動機能:**
        - `_on_play_button_pressed`関数を完成させ、現在選択されているゲームの`executable_path`を元に、ゲームを起動するロジックを実装した。
- **デバッグと問題解決の軌跡:**
    - **`Case Mismatch`警告の解決:** `Global.gd`のファイル名をリネームし、Gitのキャッシュ問題を解決。プロジェクトの潜在的な時限爆弾を完全に解除した。
    - **`Nil`エラーとの長い戦い:**
        - Godotの複雑なライフサイクル（`@onready` vs `_ready()`）の罠を、試行錯誤の末に解明。
        - `instantiate()`されたノードにアクセスするための、唯一の正しいタイミングと方法を発見し、UIの動的生成における、最も困難な問題を解決した。
    - **外部プロセス起動の謎:**
        - `OS.create_process`と`OS.execute`の、Godot 4における、非常に複雑で、ドキュメントだけでは分かりにくい仕様変更の謎に挑んだ。
        - 「作業ディレクトリ」の問題、「`res://`パス」の解釈の問題など、数々の仮説と検証を繰り返し、最終的に、`ProjectSettings.globalize_path()`でOSが理解できる絶対パスに変換し、`OS.create_process`に渡す、という、唯一の正解にたどり着いた。
- **既知の問題点 (Known Issues):**
    - **操作方法パネルのレイアウト崩れ:**
        - 詳細情報エリアの、操作方法を表示する2つの`GridContainer`が、意図通りに均等に配置されず、レイアウトが崩れている。
        - コンテナの「サイズフラグ」に関する、より詳細な調査と修正が、今後の課題として残っている。
- **結果:**
    - **試遊会で、胸を張って使える、ランチャーの核心機能が、すべて、完全に、そして堅牢に、実装された。**
    - これにより、Issue #3の、ほぼすべての要件が完了した。

### 4. `Case Mismatch`警告の、恒久的な解決

- **目的:** 開発環境（家、学校）を移動するたびに再発していた、`Global.gd`の`Case Mismatch`警告を、根本原因から完全に断ち切り、二度と発生しないようにする。
- **原因の特定:**
    - Gitのデフォルト設定である`core.ignorecase = true`が、根本原因であることを特定。
    - この設定により、Gitはファイル名の「大文字/小文字」だけの変更を、正式な変更として認識せず、結果として、異なる環境間で、ファイル名の大文字/小文字の状態が、同期されていなかった。
- **解決策:**
    - コマンドラインから`git config core.ignorecase false`を実行し、このプロジェクトのリポジトリに対して、ファイル名の大文字/小文字を、厳密に区別するように、設定を強制的に変更した。
- **実装内容:**
    - 上記設定の変更後、改めて`global.gd`を`Global.gd`にリネームし、Gitが「`global.gd`の削除」と「`Global.gd`の追加」として、変更を正しく認識することを確認。
    - この変更を、独立したコミットとして記録した。
- **結果:**
    - これにより、`Case Mismatch`問題は、恒久的に解決された。
    - 今後、どの環境で開発を行っても、`Global.gd`のファイル名は、常に、大文字始まりの、正しい状態で、維持される。

### 5. Issue #3 UIの最終調整と、バグの完全修正 (v0.1.0-dev.10)

- **目的:** 試遊会に向けて、UIの「最後の10%」を磨き上げ、残っていたすべてのバグと、レイアウトの不整合を、完全に修正する。
- **実装内容と問題解決の軌跡:**
    - **サムネイル巨大化問題の解決:**
        - **原因:** `game_thumbnail` (`Panel`) のサイズフラグが、親コンテナの幅に合わせて、高さを自動調整してしまっていた。
        - **解決:** `game_thumbnail`の「垂直拡大」フラグをオフにし、高さを`Custom Minimum Size`で固定。さらに、親である`GameList` (`VBoxContainer`) を、`CenterContainer`で囲むことで、リストの「中央揃え」と「正しいサイズ」を、完璧に両立させた。
    - **自動スクロール機能の探求と、最終的な結論:**
        - **挑戦:** Godot 4の、よりモダンな「フォーカス追従 (`Follow Focus`)」システムを使った、自動スクロールの実装に挑戦。
        - **問題:** しかし、`CenterContainer`との競合や、キー入力のハンドリングの複雑化により、動作が不安定になる問題が発生。
        - **結論:** 試遊会までの、限られた時間と、安定性を最優先するため、よりシンプルで、確実な**「手動インデックス管理 (`current_selection_index`)」**と**`ensure_control_visible()`**を組み合わせる、当初の方式に回帰することを決定。これにより、UIの挙動は、完全に、予測可能で、安定したものになった。
- **既知の問題点 (Known Issues):**
    - **カルーセルのスクロールバー:**
        - `ScrollContainer`のスクロールバーが、まだ表示されたままである。これを、機能は維持しつつ、見た目上は、完全に非表示にする必要がある。
    - **操作方法パネルのレイアウト崩れ:**
        - 詳細情報エリアの、操作方法を表示する2つの`GridContainer`が、意図通りに均等に配置されず、レイ-アウトが崩れている。コンテナの「サイズフラグ」に関する、より詳細な調査と修正が、今後の課題として残っている。
- **結果:**
    - **ランチャーのUIの、主要なインタラクティブ機能は、ほぼ完成した。**
    - しかし、試遊会で、最高の体験を提供するためには、上記の「既知の問題点」を、明日、解決する必要がある。

### 6. Issue #3 背景画像の動的更新機能を実装 (v0.1.0-dev.11)

- **目的:** ユーザーがゲームリストの項目を選択するたびに、背景が、そのゲームのアートワークに、リアルタイムで切り替わる、リッチな視覚体験を実装する。
- **実装内容:**
    - **`menu.gd`の`update_display`関数を拡張:**
        - 選択されたゲームの`background_path`を、`launcher_info.json`から取得するロジックを追加。
        - `FileAccess.file_exists()`を使い、指定されたパスに、ファイルが実際に存在するかを、事前に、安全に確認する。
        - もし、ファイルが存在し、かつ、それが画像ファイル（png, jpg, svgなど）であれば、`Image.load()`と`ImageTexture.create_from_image()`を使い、プロジェクト外部の画像リソースを、動的に読み込んで、背景用の`TextureRect`（`%Background`）に設定する。
        - もし、パスが空欄、または、ファイルが存在しない場合は、警告ログを出力し、背景を`null`（透明）にすることで、エラーを回避する。
- **結果:**
    - ランチャーの、最も重要な視覚的演出の一つである、背景の動的更新機能が、堅牢なエラーチェックと共に、完全に実装された。

### 7. Issue #3 カルーセルのスクロールバー非表示問題を解決 (v0.1.0-dev.12)

- **目的:** ゲームリスト（カルーセル）の自動スクロール機能は維持したまま、見た目上のスクロールバーだけを完全に非表示にする。
- **問題の経緯と解決策:**
    - **試行錯誤:** 当初、`ScrollContainer`の`Scroll Mode`を`Disabled`にする方法や、インスペクターから`Theme Overrides`で`StyleBoxEmpty`を設定する方法を試したが、いずれも機能しなかったり、自動スクロール自体が無効になる問題が発生した。
    - **原因の特定:** ユーザー自身による、テスト用の`VScrollBar`ノードのインスペクター調査により、つまみ（Grabber）が「通常時」「ハイライト時」「プレス時」の3つの`StyleBox`で構成されているという「真実」を特定した。
    - **最終的な解決策:** `menu.gd`の`_ready`関数内で、`await get_tree().process_frame`の後に、`get_v_scroll_bar()`で内部的な`VScrollBar`ノードを取得。そのノードに対し、`add_theme_stylebox_override()`を使い、「溝(`scroll`)」と「3状態のつまみ(`grabber`, `grabber_highlight`, `grabber_pressed`)」の合計4つのスタイルすべてを`StyleBoxEmpty.new()`で上書きすることで、機能を一切損なうことなく、完全な透明化に成功した。

### 8. UIの最終仕上げと、全バグの修正 (v0.1.0-dev.13)

- **目的:** 試遊会に向けて、残されていたUIのレイアウト問題と、データ読み込みに関する潜在的なバグをすべて修正し、安定したバージョンを完成させる。

- **実装と問題解決の経緯:**
    - **操作方法パネルのレイアウト崩れ:**
        - **発端:** 「キーボード」「コントローラー」の見出しと、操作内容のリストが、意図通りに上下に並ばず、レイアウトが崩れていた。
        - **解決策:** 各パネル（`KeyboardPanel`, `GamepadPanel`）の内部に`VBoxContainer`を追加し、その中に見出しと操作リストを正しい順序で配置することで、垂直方向のレイアウトを完全に修正した。

    - **データ読み込みの堅牢性向上:**
        - **発端1:** `launcher_config.json`に記載されていても、実際の`Games`フォルダに存在しないゲームがあると、リストのインデックスがズレて、UIに表示される情報が混ざってしまうバグがあった。
        - **解決策1:** `Global.gd`の`load_all_games_info`関数を修正。ゲーム情報を読み込む前に、まず`DirAccess.dir_exists_absolute()`で、ゲームフォルダ自体が存在するかを確認するステップを追加。存在しない場合は、リストに追加せず、安全にスキップするようにした。
        - **発端2:** `launcher_info.json`の中身が空（`title`や`game_id`が未入力）の場合、UI上でタイトルが表示されなくなる問題があった。
        - **解決策2:** `Global.gd`で、JSON読み込み時に保険として「フォルダ名」もデータに含めるように修正。`menu.gd`側では、タイトル表示のロジックを「①`title` -> ②`game_id` -> ③`folder_name`」という3段階のフォールバック処理に強化し、いかなる場合でも何らかのタイトルが表示されるようにした。

    - **革命的なUIの再設計（統合情報パネル）:**
        - **発端:** ユーザーから「説明文と操作方法を、一つのスクロール可能なエリアにまとめたい」という、より優れたUIのアイデアが提案された。
        - **解決策:** 従来の、複数のコンテナを組み合わせる複雑な構造を完全に破棄。`RichTextLabel`が持つBBCodeの能力を最大限に活用する方針に転換した。`menu.gd`の`update_display`関数を大幅に書き換え、説明文と、キーボード・コントローラーの操作方法のすべてを、動的に一つのBBCodeテキストとして組み立て、単一の`RichTextLabel` (`DetailsText`) に流し込む、シンプルで、かつ、非常にエレガントな実装を完成させた。これにより、シーンツリーの構造が大幅に簡略化され、メンテナンス性も向上した。

- **結果:**
    - これにより、試遊会前に解決すべき、すべての既知のバグとUIの問題が、完全に修正された。
    - ランチャーは、機能的に、そして、視覚的に、ほぼ完成形と言える、非常に安定した状態に達した。

## 2025-08-08

### 1. ビルド時のパス問題を完全解決し、全環境対応を達成 (v0.1.0-dev.13)

- **目的:** Godotエディタと、エクスポートされた`.exe`の両方で、外部の`Games`フォルダへの、パスを、正しく、解決する。

- **問題の経緯と解決策:**
    - **発端:** 試遊会当日の朝、最終確認として`v0.1.0-dev.13`の`.exe`エクスポートを試みたところ、エディタ上では正常に動作するにも関わらず、`.exe`実行時にすべてのゲームフォルダを検出できない致命的な問題が発生した。
    - **原因:** 原因は、`.exe`が自己完結した環境であるため、`res://../`という相対パスを外部フォルダとして解決できないGodotの仕様にあった。
    - **最終的な解決策:** `OS.has_feature("editor")`関数を用いて、実行環境を動的に判定するロジックを`Global.gd`に導入した。
        - **エディタ実行時:** 従来通り`ProjectSettings.globalize_path()`でパスを解決する。
        - **`.exe`実行時:** `OS.get_executable_path()`で得たパスを基準に、`launcher_config.json`から`res://`の接頭辞を取り除いた上で、絶対パスを構築する。

- **結果:**
    - これにより、ランチャーは実行環境を自ら判断し、常に正しい方法でパスを解決する、非常に堅牢でポータブルなアプリケーションへと進化した。
    - この最終修正が完了した安定版を、試遊会用のセーフティ・ビルドとしてエクスポートした。
